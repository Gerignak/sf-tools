<!DOCTYPE html>
<html lang="en">
    <head>
        <title>SFTools 1.2</title>

        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="stylesheet" href="css/uikit.min.css" />
        <link rel="stylesheet" href="css/custom.css" />

        <link href="https://fonts.googleapis.com/css?family=Roboto:300&display=swap" rel="stylesheet">

        <script src="js/uikit.min.js"></script>
        <script src="js/uikit-icons.min.js"></script>
        <script src="js/jquery.3.4.1.min.js"></script>

        <script src="js/lz-string.min.js"></script>
        <script src="js/html2canvas.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.bundle.min.js" integrity="sha256-xKeoJ50pzbUGkpQxDYHD7o7hxe0LaOGeguUidbq6vis=" crossorigin="anonymous"></script>
    </head>
    <body>
        <nav class="uk-navbar-container" uk-navbar>
            <div class="uk-navbar-left">
                <ul class="uk-navbar-item uk-logo">SFTools <span style="font-size: 0.5em; margin-top: -0.6em; margin-left: 0.3em; margin-right: -0.7em">1.2 Beta</span></ul>
            </div>
        </nav>
        <div class="uk-container uk-margin-top uk-margin-bottom">
            <div class="uk-container" uk-grid>
                <div class="uk-width-1-1">
                    <div class="uk-placeholder">
                        <button class="uk-button uk-button-default uk-width-1-1" id="start-simulator">RUN SIMULATOR</button>
                        <div id="simulator-result">

                        </div>
                    </div>
                </div>
                <div class="uk-width-1-2">
                    <article class="uk-comment uk-comment-primary">
                        <header class="uk-comment-header uk-flex uk-flex-between">
                            <button class="uk-button uk-button-secondary uk-button-small">EDIT</button>
                            <button class="uk-button uk-button-danger uk-button-small">REMOVE</button>
                        </header>
                        <div class="uk-comment-body">
                            <div class="uk-grid-small" uk-grid>
                                <div class="uk-width-1-4">
                                    CLASS
                                </div>
                                <div class="uk-width-3-4">
                                    <select class="uk-select uk-form-small" id="pclass">
                                        <option value="warrior">WARRIOR</option>
                                        <option value="scout">SCOUT</option>
                                        <option value="mage">MAGE</option>
                                        <option value="battlemage">BATTLE MAGE</option>
                                        <option value="assassin">ASSASSIN</option>
                                        <option value="berserker">BERSERKER</option>
                                    </select>
                                </div>
                                <div class="uk-width-1-4">
                                    LEVEL
                                </div>
                                <div class="uk-width-3-4">
                                    <input class="uk-input uk-form-small" type="text" id="plevel">
                                </div>
                                <div class="uk-width-1-1">
                                    <hr>
                                </div>
                                <div class="uk-width-1-4">
                                    STRENGTH
                                </div>
                                <div class="uk-width-1-4">
                                    <input class="uk-input uk-form-small" type="text" id="pstr">
                                </div>
                                <div class="uk-width-1-4">
                                    DEXTERITY
                                </div>
                                <div class="uk-width-1-4">
                                    <input class="uk-input uk-form-small" type="text" id="pdex">
                                </div>
                                <div class="uk-width-1-4">
                                    INTELLIGENCE
                                </div>
                                <div class="uk-width-1-4">
                                    <input class="uk-input uk-form-small" type="text" id="pint">
                                </div>
                                <div class="uk-width-1-4">
                                    CONSTITUTION
                                </div>
                                <div class="uk-width-1-4">
                                    <input class="uk-input uk-form-small" type="text" id="pcon">
                                </div>
                                <div class="uk-width-1-4">
                                    LUCK
                                </div>
                                <div class="uk-width-1-4">
                                    <input class="uk-input uk-form-small" type="text" id="plck">
                                </div>
                                <div class="uk-width-1-1">
                                    <hr>
                                </div>
                                <div class="uk-width-1-4">
                                    MIN DMG
                                </div>
                                <div class="uk-width-1-4">
                                    <input class="uk-input uk-form-small" type="text" id="pdamagemin">
                                </div>
                                <div class="uk-width-1-4">
                                    MAX DMG
                                </div>
                                <div class="uk-width-1-4">
                                    <input class="uk-input uk-form-small" type="text" id="pdamagemax">
                                </div>
                                <div class="uk-width-1-4">
                                    FIRE %
                                </div>
                                <div class="uk-width-1-4">
                                    <input class="uk-input uk-form-small" type="text" id="pdamagefire">
                                </div>
                                <div class="uk-width-1-4">
                                    COLD %
                                </div>
                                <div class="uk-width-1-4">
                                    <input class="uk-input uk-form-small" type="text" id="pdamagecold">
                                </div>
                                <div class="uk-width-1-4">
                                    LIGHTNING %
                                </div>
                                <div class="uk-width-1-4">
                                    <input class="uk-input uk-form-small" type="text" id="pdamagelightning">
                                </div>
                                <div class="uk-width-1-1">
                                    <hr>
                                </div>
                                <div class="uk-width-1-4">
                                    ARMOR
                                </div>
                                <div class="uk-width-3-4">
                                    <input class="uk-input uk-form-small" type="text" id="parmornormal">
                                </div>
                                <div class="uk-width-1-4">
                                    TOTAL %
                                </div>
                                <div class="uk-width-1-4">
                                    <input class="uk-input uk-form-small" type="text" id="parmortotal">
                                </div>
                                <div class="uk-width-1-4">
                                    FIRE %
                                </div>
                                <div class="uk-width-1-4">
                                    <input class="uk-input uk-form-small" type="text" id="parmorfire">
                                </div>
                                <div class="uk-width-1-4">
                                    COLD %
                                </div>
                                <div class="uk-width-1-4">
                                    <input class="uk-input uk-form-small" type="text" id="parmorcold">
                                </div>
                                <div class="uk-width-1-4">
                                    LIGHTNING %
                                </div>
                                <div class="uk-width-1-4">
                                    <input class="uk-input uk-form-small" type="text" id="parmorlightning">
                                </div>
                                <div class="uk-width-1-1">
                                    <hr>
                                </div>
                                <div class="uk-width-1-4">
                                    HEALTH %
                                </div>
                                <div class="uk-width-1-4">
                                    <input class="uk-input uk-form-small" type="text" id="phealthbonus">
                                </div>
                                <div class="uk-width-1-2">
                                    <label><input class="uk-checkbox" type="checkbox" id="plifepotion"> LIFE POTION</label>
                                </div>
                                <div class="uk-width-1-4">
                                    RUNE %
                                </div>
                                <div class="uk-width-1-4">
                                    <input class="uk-input uk-form-small" type="text" id="prunehealth">
                                </div>
                                <div class="uk-width-1-2">

                                </div>
                                <div class="uk-width-1-4">
                                    DAMAGE %
                                </div>
                                <div class="uk-width-1-4">
                                    <input class="uk-input uk-form-small" type="text" id="pdamagebonus">
                                </div>
                                <div class="uk-width-1-2">
                                    <label><input class="uk-checkbox" type="checkbox" id="penchantquick"> SHADOW OF THE COWBOY</label>
                                </div>
                                <div class="uk-width-1-4">
                                    GLADIATOR
                                </div>
                                <div class="uk-width-1-4">
                                    <input class="uk-input uk-form-small" type="text" id="pgladiator">
                                </div>
                                <div class="uk-width-1-2">
                                    <label><input class="uk-checkbox" type="checkbox" id="penchantcrit"> SWORD OF VENGEANCE</label>
                                </div>
                            </div>
                        </div>
                    </article>
                </div>
                <div class="uk-width-1-2">
                    <div class="uk-placeholder">
                        <p class="uk-text-center">SELECT OPPONENT</p>
                        <select class="uk-select uk-form-small uk-margin-bottom" id="dungeon-select">

                        </select>
                        <select class="uk-select uk-form-small" id="enemy-select">

                        </select>
                        <div id="enemy-manual">
                            <div class="uk-grid-small" uk-grid>
                                <div class="uk-width-1-4">
                                    CLASS
                                </div>
                                <div class="uk-width-3-4">
                                    <select class="uk-select uk-form-small" id="eclass">
                                        <option value="warrior">WARRIOR</option>
                                        <option value="scout">SCOUT</option>
                                        <option value="mage">MAGE</option>
                                        <option value="battlemage">BATTLE MAGE</option>
                                        <option value="assassin">ASSASSIN</option>
                                        <option value="berserker">BERSERKER</option>
                                    </select>
                                </div>
                                <div class="uk-width-1-4">
                                    LEVEL
                                </div>
                                <div class="uk-width-3-4">
                                    <input class="uk-input uk-form-small" type="text" id="elevel">
                                </div>
                                <div class="uk-width-1-1">
                                    <hr>
                                </div>
                                <div class="uk-width-1-4">
                                    STRENGTH
                                </div>
                                <div class="uk-width-1-4">
                                    <input class="uk-input uk-form-small" type="text" id="estr">
                                </div>
                                <div class="uk-width-1-4">
                                    DEXTERITY
                                </div>
                                <div class="uk-width-1-4">
                                    <input class="uk-input uk-form-small" type="text" id="edex">
                                </div>
                                <div class="uk-width-1-4">
                                    INTELLIGENCE
                                </div>
                                <div class="uk-width-1-4">
                                    <input class="uk-input uk-form-small" type="text" id="eint">
                                </div>
                                <div class="uk-width-1-4">
                                    CONSTITUTION
                                </div>
                                <div class="uk-width-1-4">
                                    <input class="uk-input uk-form-small" type="text" id="econ">
                                </div>
                                <div class="uk-width-1-4">
                                    LUCK
                                </div>
                                <div class="uk-width-1-4">
                                    <input class="uk-input uk-form-small" type="text" id="elck">
                                </div>
                                <div class="uk-width-1-1">
                                    <hr>
                                </div>
                                <div class="uk-width-1-4">
                                    MIN DMG
                                </div>
                                <div class="uk-width-1-4">
                                    <input class="uk-input uk-form-small" type="text" id="edamagemin">
                                </div>
                                <div class="uk-width-1-4">
                                    MAX DMG
                                </div>
                                <div class="uk-width-1-4">
                                    <input class="uk-input uk-form-small" type="text" id="edamagemax">
                                </div>
                                <div class="uk-width-1-4">
                                    FIRE %
                                </div>
                                <div class="uk-width-1-4">
                                    <input class="uk-input uk-form-small" type="text" id="edamagefire">
                                </div>
                                <div class="uk-width-1-4">
                                    COLD %
                                </div>
                                <div class="uk-width-1-4">
                                    <input class="uk-input uk-form-small" type="text" id="edamagecold">
                                </div>
                                <div class="uk-width-1-4">
                                    LIGHTNING %
                                </div>
                                <div class="uk-width-1-4">
                                    <input class="uk-input uk-form-small" type="text" id="edamagelightning">
                                </div>
                                <div class="uk-width-1-1">
                                    <hr>
                                </div>
                                <div class="uk-width-1-4">
                                    ARMOR
                                </div>
                                <div class="uk-width-3-4">
                                    <input class="uk-input uk-form-small" type="text" id="earmornormal">
                                </div>
                                <div class="uk-width-1-4">
                                    TOTAL %
                                </div>
                                <div class="uk-width-1-4">
                                    <input class="uk-input uk-form-small" type="text" id="earmortotal">
                                </div>
                                <div class="uk-width-1-4">
                                    FIRE %
                                </div>
                                <div class="uk-width-1-4">
                                    <input class="uk-input uk-form-small" type="text" id="earmorfire">
                                </div>
                                <div class="uk-width-1-4">
                                    COLD %
                                </div>
                                <div class="uk-width-1-4">
                                    <input class="uk-input uk-form-small" type="text" id="earmorcold">
                                </div>
                                <div class="uk-width-1-4">
                                    LIGHTNING %
                                </div>
                                <div class="uk-width-1-4">
                                    <input class="uk-input uk-form-small" type="text" id="earmorlightning">
                                </div>
                                <div class="uk-width-1-1">
                                    <hr>
                                </div>
                                <div class="uk-width-1-4">
                                    HEALTH %
                                </div>
                                <div class="uk-width-1-4">
                                    <input class="uk-input uk-form-small" type="text" id="ehealthbonus">
                                </div>
                                <div class="uk-width-1-2">
                                    <label><input class="uk-checkbox" type="checkbox" id="elifepotion"> LIFE POTION</label>
                                </div>
                                <div class="uk-width-1-4">
                                    RUNE %
                                </div>
                                <div class="uk-width-1-4">
                                    <input class="uk-input uk-form-small" type="text" id="erunehealth">
                                </div>
                                <div class="uk-width-1-2">

                                </div>
                                <div class="uk-width-1-4">
                                    DAMAGE %
                                </div>
                                <div class="uk-width-1-4">
                                    <input class="uk-input uk-form-small" type="text" id="edamagebonus">
                                </div>
                                <div class="uk-width-1-2">
                                    <label><input class="uk-checkbox" type="checkbox" id="eenchantquick"> SHADOW OF THE COWBOY</label>
                                </div>
                                <div class="uk-width-1-4">
                                    GLADIATOR
                                </div>
                                <div class="uk-width-1-4">
                                    <input class="uk-input uk-form-small" type="text" id="egladiator">
                                </div>
                                <div class="uk-width-1-2">
                                    <label><input class="uk-checkbox" type="checkbox" id="eenchantcrit"> SWORD OF VENGEANCE</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script src="js/dungeons.js"></script>
        <script type="text/javascript">
            $(function () {
                $('#start-simulator').prop('disabled', true);
                $('#enemy-manual').hide();
                $('#enemy-select').hide();

                $('#dungeon-select').append('<option value="-2"></option>');
                $('#dungeon-select').append('<option value="-1">CUSTOM OPPONENT</option>');

                Object.entries(OPTIONS).forEach(function (keyval) {
                    if (keyval[1].group) {
                        $('#dungeon-select').append(`<option disabled class="uk-text-muted">${keyval[1].group}</option>`);
                    }

                    $('#dungeon-select').append(`<option value="${keyval[0]}">${keyval[1].name}</option>`);
                });

                $('#dungeon-select').on('change', function () {
                    let content = [];

                    if ($(this).val() >= 0) {
                        let dungeon = OPTIONS[$(this).val()].enemies;

                        Object.entries(dungeon).forEach(function (keyval) {
                            content.push(`<option value="${keyval[0]}">${keyval[1].enemy_level} - ${keyval[1].enemy_name.toUpperCase()}</option>`);
                        });

                        $('#enemy-select').show();
                    } else {
                        $('#enemy-select').hide();
                    }

                    if ($(this).val() == -1) {
                        $('#enemy-manual').show();
                    } else {
                        $('#enemy-manual').hide();
                    }

                    $('#enemy-select').html(content.join(''));

                    if ($(this).val() < -1) {
                        $('#start-simulator').prop('disabled', true);
                    } else {
                        $('#start-simulator').prop('disabled', false);
                    }
                });

                $('#start-simulator').on('click', function () {
                    $('#start-simulator').prop('disabled', true);
                    $('#simulator-result').html(`<div class="uk-flex uk-flex-center uk-margin-top"><div uk-spinner="ratio: 2.5"></div></div>`);

                    setTimeout(function () {
                        let enemyModel = {};

                        if ($('#dungeon-select').val() == -1) {console.log('a');
                            enemyModel = {
                                class: $('#eclass').val(),
                                level: Number($('#elevel').val()) || 1,
                                str: Number($('#estr').val()) || 1,
                                dex: Number($('#edex').val()) || 1,
                                int: Number($('#eint').val()) || 1,
                                con: Number($('#econ').val()) || 1,
                                lck: Number($('#elck').val()) || 1,
                                armor: {
                                    normal: Number($('#earmornormal').val()),
                                    total: Number($('#earmortotal').val()),
                                    fire: Number($('#earmorfire').val()),
                                    cold: Number($('#earmorcold').val()),
                                    lightning: Number($('#earmorlightning').val())
                                },
                                damage: {
                                    min: Number($('#edamagemin').val()),
                                    max: Number($('#edamagemax').val()) || 1,
                                    fire: Number($('#edamagefire').val()),
                                    cold: Number($('#edamagecold').val()),
                                    lightning: Number($('#edamagelightning').val())
                                },
                                healthbonus: Number($('#ehealthbonus').val()),
                                damagebonus: Number($('#edamagebonus').val()),
                                lifepotion: $('#elifepotion').prop('checked'),
                                gladiator: Number($('#egladiator').val()),
                                runehealth: Number($('#erunehealth').val()),
                                enchantcrit: $('#eenchantcrit').prop('checked'),
                                enchantquick: $('#eenchantquick').prop('checked')
                            };
                        } else {
                            enemyModel = toModel(OPTIONS[$('#dungeon-select').val()].enemies[$('#enemy-select').val()]);
                        }

                        let playerModel = {
                            class: $('#pclass').val(),
                            level: Number($('#plevel').val()) || 1,
                            str: Number($('#pstr').val()) || 1,
                            dex: Number($('#pdex').val()) || 1,
                            int: Number($('#pint').val()) || 1,
                            con: Number($('#pcon').val()) || 1,
                            lck: Number($('#plck').val()) || 1,
                            armor: {
                                normal: Number($('#parmornormal').val()),
                                total: Number($('#parmortotal').val()),
                                fire: Number($('#parmorfire').val()),
                                cold: Number($('#parmorcold').val()),
                                lightning: Number($('#parmorlightning').val())
                            },
                            damage: {
                                min: Number($('#pdamagemin').val()),
                                max: Number($('#pdamagemax').val()) || 1,
                                fire: Number($('#pdamagefire').val()),
                                cold: Number($('#pdamagecold').val()),
                                lightning: Number($('#pdamagelightning').val())
                            },
                            healthbonus: Number($('#phealthbonus').val()),
                            damagebonus: Number($('#pdamagebonus').val()),
                            lifepotion: $('#plifepotion').prop('checked'),
                            gladiator: Number($('#pgladiator').val()),
                            runehealth: Number($('#prunehealth').val()),
                            enchantcrit: $('#penchantcrit').prop('checked'),
                            enchantquick: $('#penchantquick').prop('checked')
                        };

                        let result = runBattleAnalytic([ new EntityModel(playerModel) ], [ new EntityModel(enemyModel) ], 1000000);

                        $('#simulator-result').html(`
                            <div class="uk-grid-small uk-margin-medium-top uk-margin-medium-left uk-margin-medium-right" uk-grid>
                                <div class="uk-width-2-3">SUCCESS CHANCE</div>
                                <div class="uk-width-1-3">${(result.wins / result.samples < 0.01) ? (result.wins / result.samples > 0 ? '< 1' : '0') : Math.trunc(100 * result.wins / result.samples)}%</div>
                                <div class="uk-width-2-3">MUSHROOM COST</div>
                                <div class="uk-width-1-3">${Math.trunc(Math.max(1, result.samples / result.wins))}</div>
                                <div class="uk-width-2-3">ENEMY HP AVERAGE</div>
                                <div class="uk-width-1-3">${Math.trunc(100 * result.averageHP)}%</div>
                            </div>
                        `);

                        $('#start-simulator').prop('disabled', false);
                    }, 100);
                });
            });
        </script>
    </body>
</html>
